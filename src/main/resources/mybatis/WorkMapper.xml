<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lunadev.worktime.work.repository.WorkMapper">
    <select id="getWorkList" resultType="com.lunadev.worktime.work.dto.WorkListDto">
        SELECT
            w.work_id AS workId,
            w.date AS date,
        CASE
            WHEN s.schedule_type = 1 THEN 3
            WHEN s.schedule_type IS NULL THEN 4
            ELSE w.work_type
            END AS workType,
        m.member_id AS memberId,
        m.position AS position,
        m.company_id AS companyId,
        d.dept_id AS deptId,
        d.dept_name AS deptName,
        m.name AS memberName
    FROM
        member m
            LEFT JOIN work w ON w.member_id = m.member_id AND w.date = #{date}
            LEFT JOIN dept d ON m.dept_id = d.dept_id
            LEFT JOIN schedule s ON m.member_id = s.member_id
    WHERE
        m.company_id = #{companyId}
    </select>
</mapper>